{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fmodern\fcharset0 Courier;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 # \'f0\'9f\'94\'8b Gewerbespeicher-Planungstool - Vollst\'c3\'a4ndige Architektur & Implementierungsguide\
\
**Version:** 1.0  \
**Datum:** Dezember 2025  \
**Status:** Production-Ready Architecture  \
**Tech-Stack:** Next.js 15 + FastAPI + PostgreSQL + Claude Opus 4.5\
\
---\
\
## TABLE OF CONTENTS\
\
1. [Systemarchitektur](#systemarchitektur)\
2. [Tech-Stack Details](#tech-stack-details)\
3. [Database-Schema](#database-schema)\
4. [API-Spezifikation](#api-spezifikation)\
5. [Frontend-Komponenten](#frontend-komponenten)\
6. [Backend-Module](#backend-module)\
7. [Deployment-Strategie](#deployment-strategie)\
8. [Entwicklungs-Roadmap](#entwicklungs-roadmap)\
9. [Sicherheit & Performance](#sicherheit--performance)\
\
---\
\
## SYSTEMARCHITEKTUR\
\
### High-Level \'c3\'9cbersicht\
\
```\
\'e2\'94\'8c\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\uc0\u144 \
\'e2\'94\'82                     FRONTEND (Next.js 15)                       \'e2\'94\'82\
\'e2\'94\'82  Vercel Deployment                                              \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /app/dashboard (Hauptseite)                                 \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /app/planner (Konfigurator)                                 \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /app/results (Simulationsergebnisse)                        \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /app/offers (Angebotsverwaltung)                           \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /app/api (Next.js API Routes)                              \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'94\'e2\'94\'80 /app/admin (Multi-Tenant Management)                       \'e2\'94\'82\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'98\
                           \'e2\'86\'95 HTTP/REST\
\'e2\'94\'8c\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\uc0\u144 \
\'e2\'94\'82                  BACKEND (Python FastAPI)                       \'e2\'94\'82\
\'e2\'94\'82  Railway Deployment                                             \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /api/v1/simulate (Speicher-Simulation)                     \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /api/v1/optimize (KI-Optimierung)                          \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /api/v1/offer (PDF-Generierung)                            \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /api/v1/components (Komponentendatenbank)                  \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 /api/v1/auth (JWT Authentication)                         \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'94\'e2\'94\'80 /api/v1/webhooks (CRM-Integration)                         \'e2\'94\'82\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'98\
                           \'e2\'86\'95 SQL/Pools\
\'e2\'94\'8c\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\uc0\u144 \
\'e2\'94\'82               DATABASE (PostgreSQL + Redis)                     \'e2\'94\'82\
\'e2\'94\'82  Neon (Serverless PostgreSQL)                                  \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 public.users (Benutzer-Management)                         \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 public.projects (Anlageprojekte)                           \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 public.simulations (Rechenergebnisse)                      \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 public.offers (Generierte Angebote)                        \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 public.components (Komponentenkatalog)                     \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'94\'e2\'94\'80 public.leads (Lead-Management)                             \'e2\'94\'82\
\'e2\'94\'82                                                                 \'e2\'94\'82\
\'e2\'94\'82  Redis (Upstash)                                              \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 Cache f\'c3\'bcr Satellite-Imagery                               \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 Session Storage                                            \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'94\'e2\'94\'80 Queue f\'c3\'bcr PDF-Generierung                                 \'e2\'94\'82\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'98\
                           \'e2\'86\'95 APIs\
\'e2\'94\'8c\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\uc0\u144 \
\'e2\'94\'82              EXTERNE SERVICES & DATENQUELLEN                   \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 Anthropic Claude API (KI-Angebotserstellung)              \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 Google Maps API (Satellitenbild + Geo)                    \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 Open-Meteo (Wetterdaten)                                  \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 PVGIS (PV-Ertragsdaten)                                   \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 DocuSign API (E-Signatur)                                 \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'9c\'e2\'94\'80 HubSpot API (CRM-Integration)                             \'e2\'94\'82\
\'e2\'94\'82  \'e2\'94\'94\'e2\'94\'80 BnA API (Netzgeb\'c3\'bchren)                                    \'e2\'94\'82\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'80\'e2\'94\'98\
```\
\
### Datenfluss - Typical User Journey\
\
```\
1. KUNDEN-ERFASSUNG\
   User \'e2\'86\'92 Lead-Form (Frontend) \
   \'e2\'86\'92 Validierung \'e2\'86\'92 Database (projects)\
   \
2. AUTOMATISCHE STANDORT-ANALYSE\
   Postleitzahl \'e2\'86\'92 Google Maps API \
   \'e2\'86\'92 Satellite-Imagery + Wetterdaten (Open-Meteo)\
   \'e2\'86\'92 Cache in Redis\
   \
3. SPEICHER-KONFIGURATION\
   User zeichnet/konfiguriert \'e2\'86\'92 JSON an FastAPI Backend\
   \
4. SIMULATION\
   FastAPI \'e2\'86\'92 pvlib-python + OpenEMS-Logic\
   \'e2\'86\'92 Ergebnisse in DB (simulations)\
   \'e2\'86\'92 Zu Frontend streamen (WebSocket)\
   \
5. KI-ANGEBOTSERSTELLUNG\
   Simulation-Ergebnisse \'e2\'86\'92 Claude Opus 4.5 Prompt\
   \'e2\'86\'92 Intelligente Angebots-Beschreibung\
   \'e2\'86\'92 In DB speichern\
   \
6. PDF-GENERIERUNG\
   Daten + Claude-Text \'e2\'86\'92 ReportLab\
   \'e2\'86\'92 PDF mit Firma-CI\
   \'e2\'86\'92 S3-Storage (optional)\
   \
7. KUNDENPORTAL\
   Unique URL mit Angebot\
   \'e2\'86\'92 E-Signatur (DocuSign)\
   \'e2\'86\'92 CRM-Update (HubSpot)\
   \'e2\'86\'92 Bestellbest\'c3\'a4tigung\
```\
\
---\
\
## TECH-STACK DETAILS\
\
### Frontend (Next.js 15)\
\
**Kerntechnologien:**\
```json\
\{\
  "next": "15.0+",\
  "react": "19+",\
  "typescript": "5.4+",\
  "tailwindcss": "3.4+",\
  "shadcn/ui": "latest",\
  "zod": "3.22+",\
  "react-query": "@tanstack/react-query@5+",\
  "axios": "1.7+",\
  "chart.js": "4.4+",\
  "recharts": "2.10+",\
  "three": "r160+",\
  "mapbox-gl": "3.0+",\
  "@mapbox/mapbox-gl-geocoder": "latest"\
\}\
```\
\
**Ordnerstruktur:**\
```\
src/\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 app/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 (auth)/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 login/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 register/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 forgot-password/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 (dashboard)/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 layout.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 page.tsx (Dashboard Home)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 planner/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 layout.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 page.tsx (Konfigurator)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 components/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 results/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 [projectId]/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 page.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 components/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 offers/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 page.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 [offerId]/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 preview.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 admin/\
\'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 users/ (Multi-Tenant)\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 api/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 auth/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 login/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 refresh/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 projects/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 [id]/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 simulate/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 route.ts\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 offers/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 route.ts\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 webhooks/\
\'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 hubspot/\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 layout.tsx (Root Layout)\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 components/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ui/ (shadcn/ui)\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 forms/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ProjectForm.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 StorageConfigForm.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 SimulationForm.tsx\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 visualizations/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 YearlyEnergyChart.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 StorageSimulation.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ROICalculator.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 EnergyFlow3D.tsx\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 planner/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ConfiguratorStep1.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ConfiguratorStep2.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 ConfiguratorStep3.tsx\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 ConfiguratorStep4.tsx\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 common/\
\'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 Header.tsx\
\'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 Navigation.tsx\
\'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 Footer.tsx\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 hooks/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 useSimulation.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 useProject.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 useSatelliteImage.ts\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 useOffer.ts\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 lib/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 api-client.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 utils.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 validators.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 storage.ts\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 constants.ts\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 types/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 project.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 simulation.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 offer.ts\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 components.ts\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 api.ts\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 styles/\
    \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 globals.css\
```\
\
---\
\
### Backend (Python FastAPI)\
\
**Kerntechnologien:**\
```bash\
fastapi==0.115+\
uvicorn==0.30+\
sqlalchemy==2.1+\
psycopg==3.2+ # PostgreSQL Adapter\
redis==5.2+\
pydantic==2.6+\
python-jose==3.3+\
passlib==1.7+\
python-multipart==0.0+\
anthropic==0.39+ # Claude API\
aiohttp==3.10+ # Async HTTP\
reportlab==4.2+ # PDF Generation\
pillow==11.2+ # Image Processing\
pvlib==0.11+ # PV-Ertrag\
numpy==1.26+\
pandas==2.2+\
scipy==1.14+ # Scientific Computing\
scikit-learn==1.5+ # ML-Optimierung\
```\
\
**Ordnerstruktur:**\
```\
backend/\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 main.py\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 requirements.txt\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 .env.example\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 Dockerfile\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 docker-compose.yml\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 pyproject.toml\
\'e2\'94\'82\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 app/\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 config.py (Settings, Environment)\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 dependencies.py (Shared Dependencies)\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 security.py (JWT, Auth)\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 api/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 v1/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 router.py (Root Router)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 endpoints/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 auth.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 projects.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 simulations.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 offers.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 components.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 optimize.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 webhook.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 health.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 models/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 request.py (Pydantic Models)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 response.py\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 core/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 simulator.py (pvlib Integration)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 optimizer.py (KI-Optimierung)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 storage_logic.py (Speicher-Steuerung)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 financial.py (Wirtschaftliche Modelle)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 weather.py (Wetterdaten-Integration)\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 services/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 claude_service.py (Claude API Integration)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 pdf_service.py (PDF-Generierung)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 database.py (DB-Operations)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 cache.py (Redis Caching)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 external_api.py (Google Maps, Open-Meteo)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 crm.py (HubSpot Integration)\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 models/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 database.py (SQLAlchemy Models)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 schemas.py (Pydantic Schemas)\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 crud/\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 project.py (CRUD Operations)\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 simulation.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 offer.py\
\'e2\'94\'82   \'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 user.py\
\'e2\'94\'82   \'e2\'94\'82\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 utils/\
\'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 __init__.py\
\'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 logger.py\
\'e2\'94\'82       \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 validators.py\
\'e2\'94\'82       \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 helpers.py\
\'e2\'94\'82\
\'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 migrations/\
\'e2\'94\'82   \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 alembic/ (Database Migrations)\
\'e2\'94\'82\
\'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 tests/\
    \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 test_simulator.py\
    \'e2\'94\'9c\'e2\'94\'80\'e2\'94\'80 test_api.py\
    \'e2\'94\'94\'e2\'94\'80\'e2\'94\'80 test_integration.py\
```\
\
---\
\
## DATABASE-SCHEMA\
\
### PostgreSQL Schema (Neon)\
\
```sql\
-- Extensions\
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";\
CREATE EXTENSION IF NOT EXISTS "postgis";\
\
-- 1. Users (Multi-Tenant)\
CREATE TABLE users (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    email VARCHAR(255) UNIQUE NOT NULL,\
    hashed_password VARCHAR(255) NOT NULL,\
    first_name VARCHAR(100),\
    last_name VARCHAR(100),\
    company_name VARCHAR(255),\
    phone VARCHAR(20),\
    is_active BOOLEAN DEFAULT true,\
    is_admin BOOLEAN DEFAULT false,\
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_users_email ON users(email);\
\
-- 2. Projects (Anlagenprojekte)\
CREATE TABLE projects (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\
    \
    -- Kundeninfo\
    customer_name VARCHAR(255) NOT NULL,\
    customer_email VARCHAR(255),\
    customer_phone VARCHAR(20),\
    customer_company VARCHAR(255),\
    \
    -- Standort\
    address VARCHAR(500) NOT NULL,\
    postal_code VARCHAR(10),\
    city VARCHAR(100),\
    latitude DECIMAL(10, 8),\
    longitude DECIMAL(11, 8),\
    \
    -- Projekt-Grunddaten\
    project_name VARCHAR(255) NOT NULL,\
    description TEXT,\
    status VARCHAR(50) DEFAULT 'draft', -- draft, active, completed, archived\
    \
    -- PV-Anlagendaten\
    pv_peak_power_kw DECIMAL(10, 2), -- kW\
    pv_orientation VARCHAR(50), -- 'north', 'south', 'east', 'west'\
    pv_tilt_angle DECIMAL(5, 2), -- Grad\
    roof_area_sqm DECIMAL(10, 2), -- m\'c2\'b2\
    \
    -- Speicherdaten\
    battery_capacity_kwh DECIMAL(10, 2),\
    battery_power_kw DECIMAL(10, 2),\
    battery_chemistry VARCHAR(50), -- 'LFP', 'NCA', 'NMC'\
    battery_manufacturer VARCHAR(100),\
    \
    -- Stromverbrauch\
    annual_consumption_kwh DECIMAL(10, 2),\
    peak_load_kw DECIMAL(10, 2),\
    \
    -- Kostenparameter\
    electricity_price_eur_kwh DECIMAL(6, 4),\
    grid_fee_eur_kwh DECIMAL(6, 4),\
    feed_in_tariff_eur_kwh DECIMAL(6, 4),\
    \
    -- Timestamps\
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_projects_user_id ON projects(user_id);\
CREATE INDEX idx_projects_status ON projects(status);\
CREATE INDEX idx_projects_postal_code ON projects(postal_code);\
\
-- 3. Simulations (Berechnungsergebnisse)\
CREATE TABLE simulations (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,\
    \
    -- Simulationsparameter\
    simulation_type VARCHAR(50) DEFAULT 'standard', -- standard, peak-shaving, arbitrage\
    time_resolution VARCHAR(20) DEFAULT 'hourly', -- hourly, daily, yearly\
    \
    -- Ergebnisse (pro Jahr)\
    pv_generation_kwh DECIMAL(12, 2),\
    consumed_from_grid_kwh DECIMAL(12, 2),\
    self_consumed_kwh DECIMAL(12, 2),\
    fed_to_grid_kwh DECIMAL(12, 2),\
    battery_discharge_cycles DECIMAL(10, 2),\
    \
    -- Kennzahlen\
    autonomy_degree_percent DECIMAL(5, 2),\
    self_consumption_ratio_percent DECIMAL(5, 2),\
    pv_coverage_percent DECIMAL(5, 2),\
    \
    -- Finanzen (30-j\'c3\'a4hriger Betrachtungszeitraum)\
    annual_savings_eur DECIMAL(10, 2),\
    total_savings_eur DECIMAL(12, 2),\
    payback_period_years DECIMAL(5, 1),\
    npv_eur DECIMAL(12, 2),\
    irr_percent DECIMAL(6, 2),\
    \
    -- Ergebnisdaten (JSON f\'c3\'bcr flexible Struktur)\
    hourly_data JSONB, -- Array mit st\'c3\'bcndlichen Werten\
    monthly_summary JSONB, -- Monatliche Aggregation\
    \
    -- Status\
    is_latest BOOLEAN DEFAULT true,\
    status VARCHAR(50) DEFAULT 'completed', -- completed, failed\
    \
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_simulations_project_id ON simulations(project_id);\
CREATE INDEX idx_simulations_latest ON simulations(project_id, is_latest);\
\
-- 4. Offers (Generierte Angebote)\
CREATE TABLE offers (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    simulation_id UUID NOT NULL REFERENCES simulations(id),\
    project_id UUID NOT NULL REFERENCES projects(id),\
    \
    -- Angebots-Metadaten\
    offer_number VARCHAR(50) UNIQUE,\
    offer_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\
    valid_until DATE,\
    \
    -- Angebotsinhalte\
    offer_text TEXT, -- Claude-generierte Beschreibung\
    technical_specs JSONB, -- Technische Datenbl\'c3\'a4tter\
    components_bom JSONB, -- Bill of Materials\
    pricing_breakdown JSONB, -- Kostenaufschl\'c3\'bcsselung\
    \
    -- E-Signatur & Vertragsmanagement\
    signature_link VARCHAR(500), -- DocuSign Link\
    is_signed BOOLEAN DEFAULT false,\
    signed_at TIMESTAMP,\
    signer_name VARCHAR(255),\
    \
    -- PDF-Speicherung\
    pdf_path VARCHAR(500), -- S3 oder lokaler Pfad\
    pdf_generated_at TIMESTAMP,\
    \
    -- CRM-Integration\
    hubspot_deal_id VARCHAR(100),\
    crm_sync_status VARCHAR(50) DEFAULT 'pending', -- pending, synced, failed\
    \
    -- Status\
    status VARCHAR(50) DEFAULT 'draft', -- draft, sent, viewed, signed, completed, rejected\
    \
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_offers_simulation_id ON offers(simulation_id);\
CREATE INDEX idx_offers_project_id ON offers(project_id);\
CREATE INDEX idx_offers_status ON offers(status);\
\
-- 5. Components (Komponentenkatalog)\
CREATE TABLE components (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    \
    -- Kategorisierung\
    category VARCHAR(50) NOT NULL, -- 'inverter', 'battery', 'pv_module', 'mounting', 'wiring'\
    subcategory VARCHAR(50),\
    \
    -- Komponenteninfo\
    manufacturer VARCHAR(100) NOT NULL,\
    model VARCHAR(150) NOT NULL,\
    description TEXT,\
    specification JSONB, -- Technische Spezifikationen\
    \
    -- Kosten\
    unit_price_eur DECIMAL(10, 2),\
    supplier_sku VARCHAR(100),\
    availability_status VARCHAR(50), -- 'in_stock', 'limited', 'on_order', 'discontinued'\
    \
    -- Kompatibilit\'c3\'a4t\
    compatible_with JSONB, -- Liste kompatible Komponenten\
    \
    -- Admin\
    is_active BOOLEAN DEFAULT true,\
    data_source VARCHAR(100), -- Hersteller, Distributor, etc.\
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_components_category ON components(category);\
CREATE INDEX idx_components_manufacturer ON components(manufacturer);\
\
-- 6. Leads (CRM Integration)\
CREATE TABLE leads (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    \
    -- Kontaktdaten\
    first_name VARCHAR(100),\
    last_name VARCHAR(100),\
    email VARCHAR(255),\
    phone VARCHAR(20),\
    company VARCHAR(255),\
    \
    -- Projekt-Interesse\
    interested_in VARCHAR(100), -- 'pv_only', 'pv_storage', 'storage_only'\
    estimated_budget_eur DECIMAL(10, 2),\
    \
    -- HubSpot Integration\
    hubspot_contact_id VARCHAR(100),\
    hubspot_deal_id VARCHAR(100),\
    \
    -- Status\
    lead_status VARCHAR(50), -- 'new', 'qualified', 'proposal', 'negotiating', 'closed_won'\
    \
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_leads_email ON leads(email);\
CREATE INDEX idx_leads_hubspot_contact_id ON leads(hubspot_contact_id);\
\
-- 7. Audit Log (F\'c3\'bcr Compliance)\
CREATE TABLE audit_log (\
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\
    user_id UUID REFERENCES users(id),\
    entity_type VARCHAR(50),\
    entity_id UUID,\
    action VARCHAR(50), -- 'create', 'update', 'delete', 'view'\
    changes JSONB,\
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
CREATE INDEX idx_audit_user_id ON audit_log(user_id);\
CREATE INDEX idx_audit_entity ON audit_log(entity_type, entity_id);\
\
-- Views f\'c3\'bcr h\'c3\'a4ufige Queries\
CREATE VIEW project_with_latest_simulation AS\
SELECT \
    p.*,\
    s.id AS latest_simulation_id,\
    s.autonomy_degree_percent,\
    s.annual_savings_eur,\
    s.payback_period_years\
FROM projects p\
LEFT JOIN LATERAL (\
    SELECT * FROM simulations \
    WHERE project_id = p.id \
    ORDER BY created_at DESC \
    LIMIT 1\
) s ON true;\
```\
\
---\
\
## API-SPEZIFIKATION\
\
### REST API Endpoints (OpenAPI 3.0)\
\
#### Authentication\
\
```yaml\
POST /api/v1/auth/login\
  Summary: Benutzer-Login\
  Request:\
    email: string (format: email)\
    password: string (minLength: 8)\
  Response 200:\
    access_token: string (JWT)\
    refresh_token: string\
    user: object\
  \
POST /api/v1/auth/register\
  Summary: Neue Benutzer-Registrierung\
  Request:\
    email: string\
    password: string\
    first_name: string\
    last_name: string\
    company_name: string\
  Response 201:\
    user_id: UUID\
    \
POST /api/v1/auth/refresh\
  Summary: Token erneuern\
  Headers:\
    Authorization: Bearer \{refresh_token\}\
  Response 200:\
    access_token: string\
```\
\
#### Projects (Anlagenprojekte)\
\
```yaml\
GET /api/v1/projects\
  Summary: Alle Projekte des Benutzers auflisten\
  Query Parameters:\
    skip: integer (default: 0)\
    limit: integer (default: 20)\
    status: string (optional) # draft, active, completed\
  Response 200:\
    total: integer\
    items: array[Project]\
\
POST /api/v1/projects\
  Summary: Neues Projekt erstellen\
  Request:\
    customer_name: string\
    customer_email: string\
    address: string\
    postal_code: string\
    project_name: string\
    pv_peak_power_kw: number\
    battery_capacity_kwh: number\
    annual_consumption_kwh: number\
  Response 201:\
    project_id: UUID\
    project: Project\
\
GET /api/v1/projects/\{project_id\}\
  Summary: Projektdetails abrufen\
  Response 200:\
    Project (with nested simulations)\
\
PATCH /api/v1/projects/\{project_id\}\
  Summary: Projekt aktualisieren\
  Request:\
    (any fields from Project)\
  Response 200:\
    Project\
```\
\
#### Simulations (Speicher-Berechnungen)\
\
```yaml\
POST /api/v1/simulate\
  Summary: Neue Simulation starten\
  Request:\
    project_id: UUID\
    simulation_type: string # standard, peak-shaving, arbitrage\
    run_async: boolean (default: true)\
  Response 202 (Accepted) oder 200:\
    simulation_id: UUID\
    status: string # pending, running, completed, failed\
    results: Simulation (if completed)\
\
GET /api/v1/simulations/\{simulation_id\}\
  Summary: Simulationsergebnisse abrufen\
  Response 200:\
    Simulation (with hourly_data, monthly_summary)\
\
GET /api/v1/projects/\{project_id\}/simulations\
  Summary: Alle Simulationen eines Projekts\
  Response 200:\
    items: array[Simulation]\
```\
\
#### Offers (Angebotserstellung)\
\
```yaml\
POST /api/v1/offers\
  Summary: Angebot aus Simulation generieren\
  Request:\
    simulation_id: UUID\
    generate_pdf: boolean (default: true)\
    send_to_customer: boolean (default: false)\
  Response 201:\
    offer_id: UUID\
    offer: Offer (with generated PDF)\
\
GET /api/v1/offers/\{offer_id\}\
  Summary: Angebotdetails abrufen\
  Response 200:\
    Offer\
\
GET /api/v1/offers/\{offer_id\}/preview\
  Summary: Angebots-Preview (HTML)\
  Response 200:\
    html: string\
\
PUT /api/v1/offers/\{offer_id\}/send\
  Summary: Angebot an Kunde senden\
  Request:\
    customer_email: string\
    message: string (optional)\
  Response 200:\
    email_sent_at: timestamp\
\
GET /api/v1/offers/\{offer_id\}/signature-link\
  Summary: E-Signatur-Link generieren\
  Response 200:\
    signature_link: string (DocuSign URL)\
```\
\
#### Components (Komponentendatenbank)\
\
```yaml\
GET /api/v1/components\
  Summary: Komponenten suchen/filtern\
  Query Parameters:\
    category: string # inverter, battery, pv_module\
    manufacturer: string (optional)\
    min_price: number (optional)\
    max_price: number (optional)\
  Response 200:\
    items: array[Component]\
\
GET /api/v1/components/\{component_id\}\
  Summary: Komponentendetails\
  Response 200:\
    Component (with specifications)\
```\
\
#### Optimization (KI-Optimierung)\
\
```yaml\
POST /api/v1/optimize\
  Summary: KI-basierte System-Optimierung\
  Request:\
    project_id: UUID\
    optimization_target: string # max-autonomy, min-cost, max-roi\
    constraints: object # optional: max_budget, min_autonomy, etc.\
  Response 202 oder 200:\
    optimized_project: Project\
    recommendations: array\
    estimated_savings: number\
```\
\
#### Analytics (Reporting)\
\
```yaml\
GET /api/v1/analytics/dashboard\
  Summary: Dashboard-Metriken\
  Query Parameters:\
    period: string # week, month, year\
  Response 200:\
    total_projects: integer\
    total_simulations: integer\
    avg_autonomy: number\
    avg_payback_period: number\
\
GET /api/v1/analytics/projects/\{project_id\}\
  Summary: Projekt-Analytics\
  Response 200:\
    kpis: object\
    comparison_industry_standard: object\
```\
\
---\
\
## FRONTEND-KOMPONENTEN\
\
### Hauptkomponenten (React/TypeScript)\
\
#### 1. ProjectForm Component\
\
```typescript\
// components/forms/ProjectForm.tsx\
interface ProjectFormData \{\
  customerName: string;\
  customerEmail: string;\
  address: string;\
  postalCode: string;\
  projectName: string;\
  pvPeakPowerKw: number;\
  pvOrientation: 'north' | 'south' | 'east' | 'west';\
  pvTiltAngle: number;\
  batteryCapacityKwh: number;\
  batteryPowerKw: number;\
  annualConsumptionKwh: number;\
  electricityPriceEurKwh: number;\
  gridFeeEurKwh: number;\
\}\
\
export const ProjectForm: React.FC<\{\
  onSubmit: (data: ProjectFormData) => Promise<void>;\
\}> = (\{ onSubmit \}) => \{\
  const [isLoading, setIsLoading] = useState(false);\
  const form = useForm<ProjectFormData>(\{\
    resolver: zodResolver(projectFormSchema),\
  \});\
\
  const handleSubmit = async (data: ProjectFormData) => \{\
    setIsLoading(true);\
    try \{\
      await onSubmit(data);\
    \} finally \{\
      setIsLoading(false);\
    \}\
  \};\
\
  return (\
    <Form \{...form\}>\
      <form onSubmit=\{form.handleSubmit(handleSubmit)\} className="space-y-6">\
        \{/* Kundeninfo */\}\
        <FormField name="customerName" render=\{(\{ field \}) => (\
          <FormItem>\
            <FormLabel>Kundenname</FormLabel>\
            <FormControl>\
              <Input \{...field\} placeholder="Max Mustermann" />\
            </FormControl>\
          </FormItem>\
        )\} />\
        \
        \{/* Weitere Felder... */\}\
        \
        <Button type="submit" disabled=\{isLoading\}>\
          \{isLoading ? 'Wird gespeichert...' : 'Projekt erstellen'\}\
        </Button>\
      </form>\
    </Form>\
  );\
\};\
```\
\
#### 2. Simulator Component (Echtzeit-Berechnung)\
\
```typescript\
// components/visualizations/StorageSimulation.tsx\
export const StorageSimulation: React.FC<\{\
  projectId: string;\
\}> = (\{ projectId \}) => \{\
  const \{ data: simulation, isLoading \} = useQuery(\{\
    queryKey: ['simulation', projectId],\
    queryFn: () => api.simulate(projectId),\
  \});\
\
  if (isLoading) return <Skeleton className="w-full h-96" />;\
\
  return (\
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">\
      \{/* Jahresverlauf */\}\
      <div className="bg-white p-6 rounded-lg shadow">\
        <h3 className="text-lg font-semibold mb-4">Jahresverlauf</h3>\
        <ResponsiveContainer width="100%" height=\{300\}>\
          <LineChart data=\{simulation.hourly_data\}>\
            <CartesianGrid strokeDasharray="3 3" />\
            <XAxis />\
            <YAxis />\
            <Tooltip />\
            <Legend />\
            <Line type="monotone" dataKey="pv_generation" stroke="#fbbf24" />\
            <Line type="monotone" dataKey="consumption" stroke="#3b82f6" />\
            <Line type="monotone" dataKey="battery_level" stroke="#10b981" />\
          </LineChart>\
        </ResponsiveContainer>\
      </div>\
\
      \{/* KPIs */\}\
      <div className="space-y-4">\
        <MetricCard\
          title="Autarkiegrad"\
          value=\{`$\{simulation.autonomy_degree_percent\}%`\}\
          icon="\'f0\'9f\'93\'8a"\
        />\
        <MetricCard\
          title="J\'c3\'a4hrliche Einsparung"\
          value=\{`\'e2\'82\'ac $\{simulation.annual_savings_eur.toLocaleString()\}`\}\
          icon="\'f0\'9f\'92\'b0"\
        />\
        <MetricCard\
          title="Amortisationszeit"\
          value=\{`$\{simulation.payback_period_years.toFixed(1)\} Jahre`\}\
          icon="\'e2\uc0\u143 \'b1\'ef\'b8\u143 "\
        />\
      </div>\
    </div>\
  );\
\};\
```\
\
#### 3. Offer Preview Component\
\
```typescript\
// components/offers/OfferPreview.tsx\
export const OfferPreview: React.FC<\{\
  offerId: string;\
\}> = (\{ offerId \}) => \{\
  const \{ data: offer, isLoading \} = useQuery(\{\
    queryKey: ['offer', offerId],\
    queryFn: () => api.getOffer(offerId),\
  \});\
\
  const handleSign = async () => \{\
    const \{ signature_link \} = await api.getSignatureLink(offerId);\
    window.open(signature_link, '_blank');\
  \};\
\
  if (isLoading) return <div>Wird geladen...</div>;\
\
  return (\
    <div className="max-w-4xl mx-auto bg-white p-12">\
      \{/* Angebotskopf */\}\
      <div className="border-b-2 border-gray-200 pb-6 mb-6">\
        <img src="/logo.png" alt="Firma Logo" className="h-12 mb-4" />\
        <div className="flex justify-between">\
          <div>\
            <h1 className="text-2xl font-bold">Angebot</h1>\
            <p className="text-gray-600">Nummer: \{offer.offer_number\}</p>\
          </div>\
          <div className="text-right text-gray-600">\
            <p>G\'c3\'bcltig bis: \{new Date(offer.valid_until).toLocaleDateString('de-DE')\}</p>\
          </div>\
        </div>\
      </div>\
\
      \{/* Kundeninfo */\}\
      <div className="grid grid-cols-2 gap-6 mb-8">\
        <div>\
          <h3 className="font-bold mb-2">Auftraggeber</h3>\
          <p>\{offer.project.customer_name\}</p>\
          <p className="text-gray-600">\{offer.project.customer_email\}</p>\
        </div>\
        <div>\
          <h3 className="font-bold mb-2">Installationsort</h3>\
          <p>\{offer.project.address\}</p>\
          <p>\{offer.project.postal_code\} \{offer.project.city\}</p>\
        </div>\
      </div>\
\
      \{/* Claude-generierte Angebots-Beschreibung */\}\
      <div className="mb-8">\
        <h2 className="text-xl font-bold mb-4">Angebotsbeschreibung</h2>\
        <div className="prose max-w-none text-gray-700">\
          \{offer.offer_text\}\
        </div>\
      </div>\
\
      \{/* St\'c3\'bcckliste & Preise */\}\
      <div className="mb-8">\
        <h2 className="text-xl font-bold mb-4">Komponenten & Preisaufschl\'c3\'bcsselung</h2>\
        <table className="w-full border-collapse">\
          <thead>\
            <tr className="bg-gray-100">\
              <th className="border p-2 text-left">Komponente</th>\
              <th className="border p-2 text-right">Menge</th>\
              <th className="border p-2 text-right">Einheit</th>\
              <th className="border p-2 text-right">Preis/Einheit</th>\
              <th className="border p-2 text-right">Gesamt</th>\
            </tr>\
          </thead>\
          <tbody>\
            \{offer.components_bom.items.map(item => (\
              <tr key=\{item.id\} className="border">\
                <td className="border p-2">\{item.description\}</td>\
                <td className="border p-2 text-right">\{item.quantity\}</td>\
                <td className="border p-2 text-right">\{item.unit\}</td>\
                <td className="border p-2 text-right">\'e2\'82\'ac \{item.unit_price.toFixed(2)\}</td>\
                <td className="border p-2 text-right">\'e2\'82\'ac \{(item.quantity * item.unit_price).toFixed(2)\}</td>\
              </tr>\
            ))\}\
          </tbody>\
          <tfoot>\
            <tr className="font-bold">\
              <td colSpan=\{4\} className="text-right p-2">Gesamtpreis:</td>\
              <td className="border p-2 text-right">\'e2\'82\'ac \{offer.components_bom.total.toFixed(2)\}</td>\
            </tr>\
          </tfoot>\
        </table>\
      </div>\
\
      \{/* E-Signatur CTA */\}\
      <div className="bg-blue-50 p-6 rounded border border-blue-200 mt-8">\
        <p className="mb-4">Bitte unterzeichnen Sie dieses Angebot, um fortzufahren:</p>\
        <Button \
          onClick=\{handleSign\} \
          className="w-full bg-blue-600 hover:bg-blue-700"\
        >\
          Jetzt unterzeichnen\
        </Button>\
      </div>\
    </div>\
  );\
\};\
```\
\
---\
\
## BACKEND-MODULE\
\
### Core Simulator Module\
\
```python\
# app/core/simulator.py\
import pvlib\
import pandas as pd\
import numpy as np\
from datetime import datetime, timedelta\
from typing import Dict, List, Tuple\
\
class PVStorageSimulator:\
    """\
    Haupt-Simulator f\'c3\'bcr PV + Speichersysteme\
    Nutzt pvlib-python f\'c3\'bcr PV-Berechnungen\
    """\
    \
    def __init__(self, latitude: float, longitude: float):\
        self.location = pvlib.location.Location(\
            latitude=latitude,\
            longitude=longitude,\
            tz='Europe/Berlin'\
        )\
    \
    async def simulate_year(\
        self,\
        pv_peak_kw: float,\
        battery_kwh: float,\
        battery_power_kw: float,\
        annual_consumption_kwh: float,\
        pv_orientation: str = 'south',\
        pv_tilt: float = 30.0,\
        year: int = 2024\
    ) -> Dict:\
        """\
        Vollst\'c3\'a4ndige Jahressimulation mit st\'c3\'bcndlicher Aufl\'c3\'b6sung\
        """\
        \
        # 1. Wetterdaten laden (TMY - Typical Meteorological Year)\
        weather = self.location.get_clearsky(\
            pd.date_range(f'\{year\}-01-01', f'\{year\}-12-31', freq='H', tz='Europe/Berlin'),\
            model='ineichen'\
        )\
        \
        # 2. PV-Leistung berechnen\
        pv_system = pvlib.pvsystem.FixedMount(surface_tilt=pv_tilt, surface_azimuth=180)\
        pv_output = pvlib.modelchain.ModelChain(\
            pv_system=pvlib.pvsystem.PVSystem(\
                module_parameters=\{\
                    'alpha_isc': 0.004539,\
                    'A_ref': 1.2,\
                    'I_L_ref': 5.114,\
                    'I_o_ref': 8.196e-10,\
                    'R_sh_ref': 381.68,\
                    'R_s': 1.065,\
                    'Adjust': 100.0,\
                    'gamma_r': -0.476\
                \},\
                inverter_parameters=\{\
                    'Paco': pv_peak_kw * 1000,\
                    'Pdco': pv_peak_kw * 1000 * 0.9,\
                    'Vdco': 400,\
                    'Pso': 10.0,\
                    'C0': -0.002,\
                    'C1': -0.003,\
                    'C2': 1.0,\
                    'C3': -0.003,\
                    'Pnt': 0.03\
                \}\
            ),\
            location=self.location\
        ).run_model(weather)\
        \
        pv_ac_output = pv_output.results.ac\
        \
        # 3. Lastprofil generieren (vereinfachtes industrielles Profil)\
        hourly_consumption = self._generate_load_profile(annual_consumption_kwh, len(pv_ac_output))\
        \
        # 4. Speicher-Logik mit Ladezyklen\
        battery_soc = np.zeros(len(pv_ac_output))\
        battery_charge = np.zeros(len(pv_ac_output))\
        battery_discharge = np.zeros(len(pv_ac_output))\
        grid_import = np.zeros(len(pv_ac_output))\
        grid_export = np.zeros(len(pv_ac_output))\
        \
        current_soc = battery_kwh / 2  # Starten mit 50% SOC\
        \
        for i in range(len(pv_ac_output)):\
            pv_gen = pv_ac_output.iloc[i]\
            load = hourly_consumption[i]\
            \
            # Energiebilanz\
            energy_surplus = pv_gen - load\
            \
            if energy_surplus > 0:\
                # \'c3\'9cberschuss vorhanden \'e2\'86\'92 Speicher laden\
                charge_available = min(energy_surplus, battery_power_kw)\
                charge_capacity_available = battery_kwh - current_soc\
                charge_actual = min(charge_available, charge_capacity_available)\
                \
                battery_charge[i] = charge_actual\
                current_soc += charge_actual\
                grid_export[i] = energy_surplus - charge_actual\
            else:\
                # Defizit vorhanden \'e2\'86\'92 Speicher entladen\
                discharge_needed = -energy_surplus\
                discharge_available = min(discharge_needed, battery_power_kw)\
                discharge_actual = min(discharge_available, current_soc)\
                \
                battery_discharge[i] = discharge_actual\
                current_soc -= discharge_actual\
                grid_import[i] = discharge_needed - discharge_actual\
            \
            battery_soc[i] = current_soc\
        \
        # 5. Finanzielle KPIs berechnen\
        total_self_consumption = pv_ac_output.sum() - grid_export.sum()\
        autonomy_degree = (total_self_consumption / annual_consumption_kwh) * 100\
        self_consumption_ratio = (total_self_consumption / pv_ac_output.sum()) * 100\
        \
        annual_savings = (\
            (total_self_consumption * electricity_price) +  # Eigenverbrauch\
            (grid_export.sum() * feed_in_tariff) -  # Einspeiseverg\'c3\'bctung\
            (grid_import.sum() * electricity_price)  # Strombezug\
        )\
        \
        # 6. Speicher-Degradation (vereinfacht)\
        cycles_per_year = battery_discharge.sum() / battery_kwh\
        degradation_per_year = cycles_per_year * 0.0005  # ~0.05% pro Zyklus\
        \
        return \{\
            'hourly_data': \{\
                'timestamp': pd.date_range(f'\{year\}-01-01', periods=len(pv_ac_output), freq='H'),\
                'pv_generation': pv_ac_output.values,\
                'consumption': hourly_consumption,\
                'battery_soc': battery_soc,\
                'battery_charge': battery_charge,\
                'battery_discharge': battery_discharge,\
                'grid_import': grid_import,\
                'grid_export': grid_export,\
            \},\
            'annual_metrics': \{\
                'pv_generation_kwh': pv_ac_output.sum(),\
                'self_consumption_kwh': total_self_consumption,\
                'grid_import_kwh': grid_import.sum(),\
                'grid_export_kwh': grid_export.sum(),\
                'autonomy_degree_percent': autonomy_degree,\
                'self_consumption_ratio_percent': self_consumption_ratio,\
                'annual_savings_eur': annual_savings,\
                'battery_cycles': cycles_per_year,\
                'degradation_percent_per_year': degradation_per_year,\
            \}\
        \}\
    \
    def _generate_load_profile(self, annual_kwh: float, hours: int) -> np.ndarray:\
        """\
        Generiert typisches Gewerbe-Lastprofil\
        """\
        # Vereinfachtes Profil: Tags\'c3\'bcber h\'c3\'b6her, nachts niedriger\
        hourly_average = annual_kwh / hours\
        profile = np.ones(hours) * hourly_average\
        \
        # Wochenendreduktion\
        for i in range(hours):\
            day_of_week = (i // 24) % 7\
            hour_of_day = i % 24\
            \
            if day_of_week >= 5:  # Samstag/Sonntag\
                profile[i] *= 0.3\
            elif hour_of_day < 6 or hour_of_day > 22:  # Nachts\
                profile[i] *= 0.2\
            elif 10 <= hour_of_day < 16:  # Mittags\
                profile[i] *= 1.2\
        \
        return profile\
```\
\
### Claude Integration f\'c3\'bcr Angebotserstellung\
\
```python\
# app/services/claude_service.py\
from anthropic import Anthropic\
import json\
\
class OfferGenerationService:\
    """\
    Nutzt Claude Opus 4.5 f\'c3\'bcr intelligente Angebots-Generierung\
    """\
    \
    def __init__(self, api_key: str):\
        self.client = Anthropic(api_key=api_key)\
    \
    async def generate_offer_text(\
        self,\
        project: Dict,\
        simulation: Dict,\
        components: List[Dict]\
    ) -> str:\
        """\
        Generiert \'c3\'bcberzeugenden Angebots-Text mit Claude\
        """\
        \
        prompt = f"""\
Du bist ein erfahrener Energieberater und Vertriebsfachmann f\'c3\'bcr Solaranlagen und Speichersysteme.\
\
PROJEKT-INFORMATIONEN:\
- Kunde: \{project['customer_name']\}\
- Adresse: \{project['address']\}, \{project['postal_code']\}\
- PV-Leistung: \{project['pv_peak_power_kw']\} kW\
- Speicherkapazit\'c3\'a4t: \{project['battery_capacity_kwh']\} kWh\
- Aktueller Stromverbrauch: \{project['annual_consumption_kwh']\} kWh/Jahr\
\
SIMULATIONSERGEBNISSE:\
- Autarkiegrad: \{simulation['autonomy_degree_percent']:.1f\}%\
- J\'c3\'a4hrliche Einsparung: \'e2\'82\'ac \{simulation['annual_savings_eur']:.2f\}\
- Amortisationszeit: \{simulation['payback_period_years']:.1f\} Jahre\
- Speicher-Zyklen pro Jahr: \{simulation['battery_cycles']:.0f\}\
\
GEPLANTE KOMPONENTEN:\
\{json.dumps(components, indent=2, ensure_ascii=False)\}\
\
AUFGABE:\
Schreibe einen professionellen, \'c3\'bcberzeugenden Angebots-Text auf Deutsch, der:\
1. Die Wirtschaftlichkeit klar erkl\'c3\'a4rt\
2. Die Unabh\'c3\'a4ngigkeit vom Stromgitter betont\
3. Umweltvorteile hervorhebt\
4. Technische Komplexit\'c3\'a4t verst\'c3\'a4ndlich macht\
5. Eine Call-to-Action enth\'c3\'a4lt\
\
Der Text sollte 2-3 Abs\'c3\'a4tze sein, professionell und verst\'c3\'a4ndlich.\
"""\
        \
        message = self.client.messages.create(\
            model="claude-opus-4-5",\
            max_tokens=1024,\
            messages=[\
                \{"role": "user", "content": prompt\}\
            ]\
        )\
        \
        return message.content[0].text\
    \
    async def optimize_system(\
        self,\
        project: Dict,\
        optimization_target: str = 'max-roi'\
    ) -> Dict:\
        """\
        Nutzt Claude f\'c3\'bcr intelligente System-Optimierung\
        """\
        \
        prompt = f"""\
OPTIMIERUNGSAUFGABE:\
Analysiere diese Gewerbespeicher-Anlage und optimiere sie f\'c3\'bcr: \{optimization_target\}\
\
PROJEKT-DATEN:\
\{json.dumps(project, indent=2, ensure_ascii=False)\}\
\
Ziel: \{\
    'max-roi': 'Maximale Rendite (ROI)',\
    'max-autonomy': 'Maximale Unabh\'c3\'a4ngigkeit',\
    'min-cost': 'Minimale Gesamtkosten'\
\}[optimization_target]\
\
Gib folgende Optimierungsempfehlungen:\
1. Ideale PV-Leistung (kW)\
2. Ideale Speicherkapazit\'c3\'a4t (kWh)\
3. Ideale Speicher-Leistung (kW)\
4. Gesch\'c3\'a4tzte Kostenersparnis durch Optimierung\
5. Begr\'c3\'bcndung der Optimierungen\
\
Antworte strukturiert in JSON.\
"""\
        \
        message = self.client.messages.create(\
            model="claude-opus-4-5",\
            max_tokens=2048,\
            messages=[\
                \{"role": "user", "content": prompt\}\
            ]\
        )\
        \
        try:\
            return json.loads(message.content[0].text)\
        except json.JSONDecodeError:\
            return \{"recommendations": message.content[0].text\}\
```\
\
---\
\
## DEPLOYMENT-STRATEGIE\
\
### Vercel Frontend Deployment\
\
```bash\
# 1. Project initialisieren\
npx create-next-app@latest gewerbespeicher-app --typescript\
\
# 2. Environment Variablen (.env.local)\
NEXT_PUBLIC_API_URL=https://api.gewerbespeicher.app\
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=***\
NEXT_PUBLIC_MAPBOX_TOKEN=***\
ANTHROPIC_API_KEY=***\
\
# 3. Vercel deployment\
npm install -g vercel\
vercel deploy --prod\
```\
\
**vercel.json:**\
```json\
\{\
  "buildCommand": "npm run build",\
  "outputDirectory": ".next",\
  "env": \{\
    "NEXT_PUBLIC_API_URL": "@api_url"\
  \},\
  "functions": \{\
    "app/api/**": \{\
      "maxDuration": 300,\
      "memory": 1024\
    \}\
  \}\
\}\
```\
\
### Railway Backend Deployment\
\
```dockerfile\
# Dockerfile (Backend)\
FROM python:3.11-slim\
\
WORKDIR /app\
\
COPY requirements.txt .\
RUN pip install --no-cache-dir -r requirements.txt\
\
COPY . .\
\
EXPOSE 8000\
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]\
```\
\
**docker-compose.yml:**\
```yaml\
version: '3.8'\
services:\
  backend:\
    build: .\
    ports:\
      - "8000:8000"\
    environment:\
      DATABASE_URL: postgresql://user:pass@db:5432/gewerbespeicher\
      REDIS_URL: redis://redis:6379\
      ANTHROPIC_API_KEY: $\{ANTHROPIC_API_KEY\}\
    depends_on:\
      - db\
      - redis\
\
  db:\
    image: postgres:16-alpine\
    environment:\
      POSTGRES_DB: gewerbespeicher\
      POSTGRES_USER: user\
      POSTGRES_PASSWORD: $\{DB_PASSWORD\}\
    volumes:\
      - postgres_data:/var/lib/postgresql/data\
\
  redis:\
    image: redis:7-alpine\
    ports:\
      - "6379:6379"\
\
volumes:\
  postgres_data:\
```\
\
---\
\
## ENTWICKLUNGS-ROADMAP\
\
### PHASE 1: MVP (Wochen 1-4)\
\
**Woche 1-2: Setup + Core**\
- [ ] GitHub Repo initialisieren (Private)\
- [ ] Next.js Project Setup (Vercel)\
- [ ] FastAPI Backend Setup (Railway)\
- [ ] PostgreSQL Database (Neon)\
- [ ] Authentication (JWT)\
- [ ] ProjectForm Component\
- [ ] Basic API Endpoints\
\
**Woche 3-4: Simulator**\
- [ ] PV-Ertrag Simulator (pvlib)\
- [ ] Speicher-Logik Implementation\
- [ ] Financial Calculations\
- [ ] API Endpoints f\'c3\'bcr Simulation\
- [ ] Results Dashboard\
- [ ] Charts & Visualisierungen\
\
**Deliverables:**\
- \'e2\'9c\'85 Funktionsf\'c3\'a4higer Konfigurator\
- \'e2\'9c\'85 Echtzeit-Kalkulator\
- \'e2\'9c\'85 Dashboard mit KPIs\
- \'e2\'9c\'85 GitHub Repo\
\
---\
\
### PHASE 2: KI & Intelligenz (Wochen 5-8)\
\
**Woche 5-6: Claude Integration**\
- [ ] Claude API Integration\
- [ ] Angebots-Text Generation\
- [ ] Komponenten-Empfehlungen\
- [ ] System-Optimierung\
\
**Woche 7-8: PDF & CRM**\
- [ ] PDF-Generierung (ReportLab)\
- [ ] E-Signatur (DocuSign)\
- [ ] CRM-Integration (HubSpot)\
- [ ] Offer Management\
\
**Deliverables:**\
- \'e2\'9c\'85 Automatische PDF-Angebote\
- \'e2\'9c\'85 E-Signatur-Workflow\
- \'e2\'9c\'85 CRM-Integration\
- \'e2\'9c\'85 Claude Opus 4.5 powered Features\
\
---\
\
### PHASE 3: Realwelt-Integration (Wochen 9-12)\
\
**Woche 9-10: Externe APIs**\
- [ ] Satellite-Imagery (Google Maps)\
- [ ] Wetterdaten (Open-Meteo)\
- [ ] Komponenten-DB (Real Prices)\
- [ ] Netzgeb\'c3\'bchren-API\
\
**Woche 11-12: Advanced Features**\
- [ ] Peak-Shaving Szenarien\
- [ ] Arbitrage-Berechnung\
- [ ] Netzentgelt-Optimierung\
- [ ] Mobile Responsiveness\
\
**Deliverables:**\
- \'e2\'9c\'85 Produktionsreife\
- \'e2\'9c\'85 Echtzeit-Daten\
- \'e2\'9c\'85 Advanced Scenarios\
- \'e2\'9c\'85 Mobile-ready\
\
---\
\
### PHASE 4: Enterprise (Wochen 13-16)\
\
**Woche 13-14: Multi-Tenant**\
- [ ] User Management\
- [ ] White-Label Support\
- [ ] Admin Dashboard\
- [ ] Analytics\
\
**Woche 15-16: API & Integration**\
- [ ] OpenAPI Specification\
- [ ] Externe API (f\'c3\'bcr Partner)\
- [ ] SAP-Integration\
- [ ] Webhook System\
\
**Deliverables:**\
- \'e2\'9c\'85 Multi-Tenant SaaS Ready\
- \'e2\'9c\'85 API f\'c3\'bcr externe Integration\
- \'e2\'9c\'85 Analytics & Reporting\
- \'e2\'9c\'85 Enterprise Features\
\
---\
\
## SICHERHEIT & PERFORMANCE\
\
### Security Checklist\
\
- [ ] HTTPS \'c3\'bcberall (TLS 1.3+)\
- [ ] CORS richtig konfigurieren\
- [ ] Input Validation (Zod/Pydantic)\
- [ ] SQL Injection Prevention (SQLAlchemy)\
- [ ] XSS Protection (React Escaping)\
- [ ] CSRF Protection (Tokens)\
- [ ] Rate Limiting (Redis)\
- [ ] API Key Management (Environment Variablen)\
- [ ] Encryption at Rest (PostgreSQL)\
- [ ] Audit Logging (Alle User-Actions)\
- [ ] GDPR Compliance (Datenl\'c3\'b6schung, Export)\
- [ ] Penetration Testing (Vor Go-Live)\
\
### Performance Optimization\
\
**Frontend:**\
- Server Components (Next.js)\
- Image Optimization\
- Code Splitting\
- CSS-in-JS (Tailwind)\
- Lazy Loading f\'c3\'bcr Charts\
- Service Worker (Offline)\
\
**Backend:**\
- Database Indexing\
- Redis Caching\
- Async/Await\
- Connection Pooling\
- Gzip Compression\
- CDN f\'c3\'bcr Static Assets (Vercel)\
\
**Datenbank:**\
- Query Optimization\
- Materialized Views\
- Partitioning (f\'c3\'bcr gro\'c3\'9fe Tabellen)\
- Backup-Strategie (automatisch)\
\
---\
\
## KOMMUNIKATIONS-STRATEGIE\
\
### API Error Handling\
\
```typescript\
// Standardisierte Error-Responses\
\{\
  "success": false,\
  "error": \{\
    "code": "VALIDATION_ERROR",\
    "message": "Input validation failed",\
    "details": [\
      \{\
        "field": "pv_peak_power_kw",\
        "message": "Muss zwischen 1 und 100 kW liegen"\
      \}\
    ]\
  \}\
\}\
```\
\
### Webhook Schema (f\'c3\'bcr HubSpot Integration)\
\
```python\
# POST /webhooks/hubspot\
\{\
  "object_id": "project-uuid",\
  "event": "offer_signed",\
  "timestamp": "2025-12-13T08:47:00Z",\
  "data": \{\
    "offer_id": "offer-uuid",\
    "customer_email": "customer@example.com",\
    "signer_name": "Max Mustermann",\
    "signed_at": "2025-12-13T08:45:00Z"\
  \}\
\}\
```\
\
---\
\
## LIZENZIERUNG & IP\
\
**Empfohlene Lizenzierung:**\
- Frontend + Backend: MIT License\
- Komponenten-Datenbank: CC-BY-4.0\
- Propriet\'c3\'a4re Features: Ihr Copyright\
\
---\
\
**Fertig zum Bauen! \'f0\'9f\'9a\'80**\
\
Alle Ressourcen sind vorbereitet. N\'c3\'a4chster Schritt: GitHub Repo initialisieren und mit Claude Code entwickeln.\
}